<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ET-NeuralCast | Evaluation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/lightbox.css" />
    <link rel="stylesheet" href="css/overlays.css" />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <a href="index.html" class="nav-brand">ET-NeuralCast</a>
      <div class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
        <a href="forecast.html" class="nav-link">Forecast</a>
        <a href="evaluation.html" class="nav-link active">Evaluation</a>
        <a href="logs.html" class="nav-link">Logs</a>
        
        <button id="theme-toggle" class="theme-toggle" title="Toggle Light/Dark Mode">
          <svg id="theme-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path id="moon-path" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            <circle id="sun-circle" cx="12" cy="12" r="5" style="display: none"></circle>
            <line id="sun-l1" x1="12" y1="1" x2="12" y2="3" style="display: none"></line>
            <line id="sun-l2" x1="12" y1="21" x2="12" y2="23" style="display: none"></line>
            <line id="sun-l3" x1="4.22" y1="4.22" x2="5.64" y2="5.64" style="display: none"></line>
            <line id="sun-l4" x1="18.36" y1="18.36" x2="19.78" y2="19.78" style="display: none"></line>
            <line id="sun-l5" x1="1" y1="12" x2="3" y2="12" style="display: none"></line>
            <line id="sun-l6" x1="21" y1="12" x2="23" y2="12" style="display: none"></line>
            <line id="sun-l7" x1="4.22" y1="19.78" x2="5.64" y2="18.36" style="display: none"></line>
            <line id="sun-l8" x1="18.36" y1="5.64" x2="19.78" y2="4.22" style="display: none"></line>
          </svg>
        </button>
      </div>
    </nav>

    <div class="container">
      <header class="hero" style="margin-top: 4rem;">
        <div class="header-main">
          <div class="hero-text" style="width: 100%;">
            <h1>Model Evaluation</h1>
            <p class="subtitle-large">
              Rigorous verification of forecast skill against historical observations (CHIRPS).
            </p>
            <div class="controls-row" style="margin-top: 2rem;">
                 <div class="status-badge">
                   <span class="pulse-dot" style="background: var(--success-color);"></span>
                   Validated on 20+ Years
                 </div>
            </div>
          </div>
        </div>
      </header>

      <section>
          <div style="margin-bottom: 4rem;">
            <h2 class="section-label" style="font-size: 2.2rem; margin-bottom: 3rem;">Metric Definitions & Interpretation</h2>
            <div class="tech-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                
                <!-- RMSE -->
                <div class="tech-card" style="padding: 2rem;">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 12h20"></path>
                            <path d="M2 17h20"></path>
                            <path d="M2 7h20"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        RMSE & MAE
                    </h3>
                    <p style="font-size: 0.95rem; margin-bottom: 0.5rem;">
                        <strong>Root Mean Square Error</strong> & <strong>Mean Absolute Error</strong> measure the average magnitude of forecast errors in physical units (mm/day).
                    </p>
                    <p style="font-size: 0.9rem; color: var(--accent);">
                        <strong>Interpretation:</strong> Lower values are better. Represents the physical distance between forecast and observation.
                    </p>
                </div>

                <!-- ACC -->
                <div class="tech-card" style="padding: 2rem;">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 3v18h18"></path>
                            <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"></path>
                        </svg>
                        ACC
                    </h3>
                    <p style="font-size: 0.95rem; margin-bottom: 0.5rem;">
                        <strong>Anomaly Correlation Coefficient</strong> measures the spatial pattern agreement between forecast and observed anomalies.
                    </p>
                    <p style="font-size: 0.9rem; color: var(--accent);">
                        <strong>Interpretation:</strong> +1 is perfect, 0 is random. Values > 0.5 indicate useful skill for spatial patterns.
                    </p>
                </div>

                <!-- HSS -->
                <div class="tech-card" style="padding: 2rem;">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        HSS
                    </h3>
                    <p style="font-size: 0.95rem; margin-bottom: 0.5rem;">
                        <strong>Heidke Skill Score</strong> measures the accuracy of categorical forecasts (e.g., Terciles) relative to random chance.
                    </p>
                    <p style="font-size: 0.9rem; color: var(--accent);">
                        <strong>Interpretation:</strong> 1 is perfect score, 0 is no skill (random).
                    </p>
                </div>

                <!-- Hit Rate -->
                <div class="tech-card" style="padding: 2rem;">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <circle cx="12" cy="12" r="6"></circle>
                            <circle cx="12" cy="12" r="2"></circle>
                        </svg>
                        Hit Rate
                    </h3>
                    <p style="font-size: 0.95rem; margin-bottom: 0.5rem;">
                        <strong>Hit Rate (Accuracy)</strong> measures the percentage of correct categorical forecasts (e.g., correct prediction of Below, Near, or Above Normal).
                    </p>
                    <p style="font-size: 0.9rem; color: var(--accent);">
                        <strong>Interpretation:</strong> Higher is better. 1.0 (100%) indicates perfect categorical accuracy.
                    </p>
                </div>
            </div>
          </div>
      </section>

      <!-- Dynamic Evaluation Report -->
      <section id="evaluation-report" style="max-width: 1000px; margin: 0 auto; margin-bottom: 6rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h2 class="section-label" style="font-size: 2.5rem; margin-bottom: 0;">Evaluation Report</h2>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <label for="eval-year-select" style="color: var(--text-secondary); font-weight: 500;">Select Year:</label>
                <select id="eval-year-select" style="padding: 0.6rem 2rem; border-radius: 0.5rem; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--card-border); font-size: 1rem; cursor: pointer;">
                    <option value="2020" selected>2020</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                </select>
                <button id="download-report-btn" class="control-pill" style="border: 1px solid var(--card-border); cursor: pointer; padding: 0.6rem 1rem; display: flex; align-items: center; gap: 0.5rem; background: var(--bg-secondary); color: var(--text-primary);">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download JSON
                </button>
            </div>
          </div>
          <div id="eval-table-container" style="background: var(--bg-secondary); border: 1px solid var(--card-border); border-radius: 2rem; padding: 2rem; box-shadow: 0 20px 40px rgba(0,0,0,0.1);">
              <p style="text-align: center; color: var(--text-secondary);">Loading report...</p>
          </div>
      </section>

      <!-- Spatial Analysis Section -->
      <section style="margin-bottom: 6rem;">
          <h2 id="spatial-title" class="section-label" style="font-size: 2.2rem; margin-bottom: 2rem;">Spatial Performance Analysis (2020)</h2>
          
          <!-- Overlay Controls -->
          <div class="toggle-group" style="justify-content: center; margin-bottom: 3rem;">
              <span style="color: var(--text-secondary); font-weight: 500;">Map Layers:</span>
              <label class="toggle-switch">
                  <input type="checkbox" id="toggle-country" checked>
                  <span class="slider"></span>
                  <span class="label">Country</span>
              </label>
              <label class="toggle-switch">
                  <input type="checkbox" id="toggle-regions">
                  <span class="slider"></span>
                  <span class="label">Regions</span>
              </label>
              <label class="toggle-switch">
                  <input type="checkbox" id="toggle-zones">
                  <span class="slider"></span>
                  <span class="label">Subregions</span>
              </label>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
              <div class="tech-card" style="padding: 0; overflow: hidden; text-align: center;">
                  <h4 style="margin: 1.5rem 0 0.5rem; font-size: 1.2rem;">Spatial Bias (mm/day)</h4>
                  <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Blue = Too Wet, Red = Too Dry</p>
                  <div class="map-overlay-wrapper">
                      <img id="img-spatial-bias" class="base-map lightbox-trigger" src="outputs/spatial_bias_2020.png" alt="Spatial Bias Map">
                      <img class="overlay-layer country-overlay" src="outputs/overlay_country.png" alt="Country">
                      <img class="overlay-layer region-overlay" src="outputs/overlay_regions.png" alt="Regions">
                      <img class="overlay-layer zone-overlay" src="outputs/overlay_zones.png" alt="Subregions">
                  </div>
              </div>
              
              <div class="tech-card" style="padding: 0; overflow: hidden; text-align: center;">
                  <h4 style="margin: 1.5rem 0 0.5rem; font-size: 1.2rem;">Root Mean Square Error (RMSE)</h4>
                  <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Lower is better (Darker Purple)</p>
                  <div class="map-overlay-wrapper">
                      <img id="img-spatial-rmse" class="base-map lightbox-trigger" src="outputs/spatial_rmse_2020.png" alt="Spatial RMSE Map">
                      <img class="overlay-layer country-overlay" src="outputs/overlay_country.png" alt="Country">
                      <img class="overlay-layer region-overlay" src="outputs/overlay_regions.png" alt="Regions">
                      <img class="overlay-layer zone-overlay" src="outputs/overlay_zones.png" alt="Subregions">
                  </div>
              </div>
              <div class="tech-card" style="padding: 0; overflow: hidden; text-align: center;">
                  <h4 style="margin: 1.5rem 0 0.5rem; font-size: 1.2rem;">Anomaly Correlation (ACC)</h4>
                  <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Red = Positive Correlation (Good)</p>
                  <div class="map-overlay-wrapper">
                      <img id="img-spatial-acc" class="base-map lightbox-trigger" src="outputs/spatial_acc_2020.png" alt="Spatial ACC Map">
                      <img class="overlay-layer country-overlay" src="outputs/overlay_country.png" alt="Country">
                      <img class="overlay-layer region-overlay" src="outputs/overlay_regions.png" alt="Regions">
                      <img class="overlay-layer zone-overlay" src="outputs/overlay_zones.png" alt="Subregions">
                  </div>
              </div>

              <div class="tech-card" style="padding: 0; overflow: hidden; text-align: center;">
                  <h4 style="margin: 1.5rem 0 0.5rem; font-size: 1.2rem;">Hit Rate (Terciles)</h4>
                  <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Yellow = High Accuracy</p>
                  <div class="map-overlay-wrapper">
                      <img id="img-spatial-hitrate" class="base-map lightbox-trigger" src="outputs/spatial_hitrate_2020.png" alt="Spatial Hit Rate Map">
                      <img class="overlay-layer country-overlay" src="outputs/overlay_country.png" alt="Country">
                      <img class="overlay-layer region-overlay" src="outputs/overlay_regions.png" alt="Regions">
                      <img class="overlay-layer zone-overlay" src="outputs/overlay_zones.png" alt="Subregions">
                  </div>
              </div>
          </div>
      </section>

      <!-- Temporal Analysis Section -->
      <section style="margin-bottom: 6rem;">
          <h2 class="section-label" style="font-size: 2.2rem; margin-bottom: 3rem;">Temporal Skill Analysis (Time-Series)</h2>
          
          <div style="display: grid; grid-template-columns: 1fr; gap: 4rem;">
              <!-- 1. Scores -->
              <div class="tech-card" style="padding: 2rem; overflow: hidden; text-align: center;">
                  <h4 style="margin: 0rem 0 1.5rem; font-size: 1.4rem;">Skill Score Evolution (ACC & Hit Rate)</h4>
                  <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 2rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                      Tracking the model's ability to capture anomalies and categorical events over the test period.
                      Consistent high scores (> 0.5) indicate robust performance.
                  </p>
                  <img id="img-temporal-skill" src="outputs/temporal_skill_2020.png" alt="Temporal Skill Chart" style="width: 100%; max-width: 1000px; height: auto; display: block; margin: 0 auto; border-radius: 1rem; border: 1px solid var(--card-border);">
              </div>

              <!-- 2. Errors -->
              <div class="tech-card" style="padding: 2rem; overflow: hidden; text-align: center;">
                  <h4 style="margin: 0rem 0 1.5rem; font-size: 1.4rem;">Error Metric Evolution (RMSE & MAE)</h4>
                  <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 2rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                      Monitoring the magnitude of forecast errors. Spikes may indicate extreme events or model divergence.
                  </p>
                  <img id="img-temporal-error" src="outputs/temporal_error_2020.png" alt="Temporal Error Chart" style="width: 100%; max-width: 1000px; height: auto; display: block; margin: 0 auto; border-radius: 1rem; border: 1px solid var(--card-border);">
              </div>
          </div>
      </section>

      <!-- Confusion Matrix Section -->
      <section style="margin-bottom: 8rem;">
          <h2 class="section-label" style="font-size: 2.2rem; margin-bottom: 3rem;">Prediction Accuracy</h2>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
              <div class="tech-card" style="padding: 2rem; overflow: hidden; text-align: center;">
                  <h4 style="margin: 0rem 0 1.5rem; font-size: 1.4rem;">Tercile Confusion Matrix</h4>
                  <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 2rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                      Visualizing the hit and miss rates for each category (Below Normal, Normal, Above Normal).
                      Darker diagonals indicate better performance.
                  </p>
                  <img id="img-confusion-matrix" src="outputs/confusion_matrix_2020.png" alt="Tercile Confusion Matrix" style="width: 100%; height: auto; display: block; margin: 0 auto; border-radius: 1rem; border: 1px solid var(--card-border);">
              </div>
              
              <div class="tech-card" style="padding: 2rem; overflow: hidden; text-align: center;">
                  <h4 style="margin: 0rem 0 1.5rem; font-size: 1.4rem;">Extreme Event (Top 10%) Matrix</h4>
                  <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 2rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                      Assessing the model's ability to capture extreme precipitation events (>90th percentile).
                      Focus on 'Extreme' detection rate.
                  </p>
                  <img id="img-extreme-confusion-matrix" src="outputs/extreme_confusion_matrix_2020.png" alt="Extreme Event Matrix" style="width: 100%; height: auto; display: block; margin: 0 auto; border-radius: 1rem; border: 1px solid var(--card-border);">
              </div>
          </div>
      </section>

      <!-- Scatter Plot Section -->
      <section style="margin-bottom: 8rem;">
          <h2 class="section-label" style="font-size: 2.2rem; margin-bottom: 3rem;">Forecast Calibration</h2>
          
          <div style="display: grid; grid-template-columns: 1fr; gap: 4rem;">
              <div class="tech-card" style="padding: 2rem; overflow: hidden; text-align: center;">
                  <h4 style="margin: 0rem 0 1.5rem; font-size: 1.4rem;">Forecast vs. Observation (Domain Mean)</h4>
                  <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 2rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                      Scatter plot of domain-averaged rainfall for each test sample.
                      Points close to the dashed 1:1 line indicate perfect calibration.
                  </p>
                  <img id="img-scatter-plot" src="outputs/scatter_plot_2020.png" alt="Forecast vs Obs Scatter Plot" style="width: 100%; max-width: 600px; height: auto; display: block; margin: 0 auto; border-radius: 1rem; border: 1px solid var(--card-border);">
              </div>
          </div>
      </section>
    </div>

    <footer>
      <p class="copyright">Advanced S2S Climate Applications | &copy; 2025</p>
    </footer>

    <script src="js/theme.js"></script>
    <script src="js/evaluation.js"></script>
    <script src="js/lightbox.js"></script>
  </body>
</html>
